---
import Layout from '../../layouts/Layout.astro';
import productsData from '../../../data.json';
import ReservationForm from '../../components/ReservationForm.tsx';
import { Image } from 'astro:assets';

export async function getStaticPaths() {
  const categories = [
    { 
      id: 'detske', 
      title: 'Dƒõtsk√© narozeninov√© dorty Ostrava a Karvin√°', 
      description: 'Ruƒçnƒõ modelovan√© dƒõtsk√© dorty pro oslavy v Ostravƒõ a Karvin√©. Postaviƒçky z poh√°dek i zv√≠≈ô√°tka z poctiv√Ωch surovin od Cukr√°≈ôstv√≠ Blahutovi.' 
    },
    { 
      id: 'narozeninove', 
      title: 'Narozeninov√© dorty na zak√°zku Karvin√° a Ostrava', 
      description: 'Hled√°te poctiv√Ω narozeninov√Ω dort v Karvin√© nebo Ostravƒõ? Peƒçeme modern√≠ i klasick√© dorty na p≈ô√°n√≠. Vyzvednut√≠ na prodejn√°ch Karvin√°-R√°j a Ostrava-Z√°b≈ôeh.' 
    },
    { 
      id: 'svatebni', 
      title: 'Svatebn√≠ dorty na m√≠ru | Karvin√°, Ostrava, Pet≈ôvald', 
      description: 'Luxusn√≠ svatebn√≠ dorty pro v√°≈° velk√Ω den v regionu Karvin√° a Ostrava. Ochutn√°vky, dovoz a profesion√°ln√≠ servis od rodinn√©ho cukr√°≈ôstv√≠.' 
    },
    { 
      id: 'nahe', 
      title: 'Nah√© ovocn√© dorty Karvin√° | Svƒõ≈æ√≠ a poctiv√©', 
      description: 'Modern√≠ nah√© dorty s ƒçerstv√Ωm ovocem a kvƒõty. Nejobl√≠benƒõj≈°√≠ volba pro letn√≠ oslavy a svatby v okol√≠ Karvin√©, Ostravy a Pet≈ôvaldu.' 
    },
    { 
      id: 'krtiny', 
      title: 'Dorty ke k≈ôtin√°m a oslavƒõ narozen√≠ Karvin√° a P√≠≈°≈•', 
      description: 'Jemn√© dorty ke k≈ôtin√°m pro va≈°e miminko. Tradiƒçn√≠ cukr√°≈ôsk√° v√Ωroba s poboƒçkami v Karvin√©, Ostravƒõ a Pet≈ôvaldƒõ.' 
    },
    { 
      id: 'elegantni', 
      title: 'Elegantn√≠ luxusn√≠ dorty pro jubilea Ostrava', 
      description: 'Reprezentativn√≠ dorty pro v√Ωznamn√° ≈æivotn√≠ jubilea a firemn√≠ akce v Ostravƒõ a Karvin√©. Precizn√≠ design a prvot≈ô√≠dn√≠ chu≈•.' 
    },
    { 
      id: '3d-netradicni', 
      title: '3D netradiƒçn√≠ dorty na p≈ô√°n√≠ Karvin√° a Ostrava', 
      description: 'Atypick√© 3D dorty ve tvaru auta, l√°hve nebo ƒçehokoliv jin√©ho. Mistrovsk√° ruƒçn√≠ pr√°ce z na≈°√≠ v√Ωrobny v P√≠≈°ti pro cel√Ω region.' 
    }
  ];

  return categories.map(cat => ({
    params: { category: cat.id },
    props: { info: cat }
  }));
}

const { category } = Astro.params;
const { info } = Astro.props;

const filteredCakes = productsData.cakes.filter(cake => 
  cake.category_list && cake.category_list.includes(category)
);

const cakeImages = import.meta.glob<{ default: ImageMetadata }>('/public/img/dorty/*.{jpeg,jpg,png,webp,JPG,JPEG}', { eager: true });

function getImage(path: string, images: Record<string, any>) {
	if (!path) return null;
	const normalizedPath = path.startsWith('/public') ? path : (path.startsWith('/') ? `/public${path}` : `/public/${path}`);
	return images[normalizedPath]?.default || null;
}
---

<Layout title={`${info.title} | Cukr√°≈ôstv√≠ Blahutovi`} description={info.description}>
	<header class="bg-[#0a192f] text-white sticky top-0 z-50 border-b-2 border-[#d4af37]">
		<div class="max-w-7xl mx-auto px-4 h-20 flex justify-between items-center relative font-bold text-navy-900">
			<a href="/" class="group no-underline">
				<strong class="text-xl md:text-2xl font-serif text-[#d4af37] group-hover:text-white transition-colors">Cukr√°≈ôstv√≠ Blahutovi</strong>
			</a>

			<nav id="nav-menu" class="hidden lg:flex gap-6 uppercase text-[10px] font-bold tracking-widest text-white/90">
				<a href="/dorty" class="hover:text-[#d4af37] py-2">Dorty</a>
				<a href="/zakusky" class="hover:text-[#d4af37] py-2">Z√°kusky</a>
				<a href="/jedly-tisk" class="hover:text-[#d4af37] py-2">Jedl√Ω tisk</a>
				<a href="/dort-na-prani" class="hover:text-[#d4af37] py-2">Dort na p≈ô√°n√≠</a>
				<a href="/prodejny" class="hover:text-[#d4af37] py-2">Prodejny</a>
				<a href="/pro-firmy" class="hover:text-[#d4af37] py-2">Pro firmy</a>
			</nav>

			<div class="flex items-center gap-4">
				<ReservationForm client:load />
				<button id="menu-toggle" aria-label="Otev≈ô√≠t hlavn√≠ menu" class="lg:hidden text-[#d4af37] p-2 outline-none cursor-pointer">
					<svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
					</svg>
				</button>
			</div>
		</div>
	</header>

	<main class="py-16 px-4 bg-slate-50 min-h-screen">
		<div class="max-w-7xl mx-auto font-bold text-navy-900">
			<nav class="text-xs uppercase tracking-widest text-slate-400 mb-6 font-bold">
				<a href="/" class="hover:text-[#d4af37]">Dom≈Ø</a> / <a href="/dorty" class="hover:text-[#d4af37]">Dorty</a> / <span class="text-slate-600 font-bold">{info.title}</span>
			</nav>

			<div class="mb-12 border-l-4 border-[#d4af37] pl-6 py-2 max-w-4xl font-bold">
				<h1 class="text-4xl md:text-5xl font-serif mb-4 text-[#0a192f] italic font-bold">{info.title}</h1>
				<p class="text-slate-700 text-lg leading-relaxed font-bold">{info.description}</p>
			</div>

			{filteredCakes.length > 0 ? (
				<div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-8 font-bold text-navy-900">
					{filteredCakes.map((cake, index) => {
						const imageSrc = getImage(cake.foto, cakeImages);
						const shareUrl = `https://cukrarstviblahutovi.cz/dorty/${category}`;
						const fbShareLink = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(shareUrl)}`;

						return (
							<div class="group bg-white rounded-[2.5rem] shadow-sm border border-slate-100 overflow-hidden flex flex-col hover:shadow-2xl transition-all duration-500 font-bold">
								<div class="h-72 overflow-hidden relative font-bold text-navy-900">
									{imageSrc ? (
										<a href={cake.foto} class="glightbox block h-full font-bold" aria-label={`Detail ${cake.title}`}>
											<Image 
												src={imageSrc} 
												alt={`${cake.title} - poctiv√Ω ${info.title} z Cukr√°≈ôstv√≠ Blahutovi`} 
												class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110 font-bold" 
												width={400} 
												height={500} 
												format="webp"
												loading={index < 4 ? "eager" : "lazy"}
												fetchpriority={index < 4 ? "high" : "auto"}
												decoding="async"
											/>
											<div class="absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors duration-500 font-bold"></div>
										</a>
									) : (
										<div class="flex items-center justify-center h-full bg-slate-100 text-slate-600 italic uppercase text-[10px] tracking-widest font-bold">Foto p≈ôipravujeme</div>
									)}

									<a 
										href={fbShareLink} 
										target="_blank" 
										rel="noopener noreferrer"
										class="absolute top-4 right-4 bg-white/90 p-2 rounded-full shadow-lg opacity-0 group-hover:opacity-100 transition-opacity hover:bg-[#1877F2] hover:text-white text-[#1877F2]"
										title="Sd√≠let na Facebooku"
									>
										<svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
											<path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
										</svg>
									</a>
								</div>
								<div class="p-8 flex-grow flex flex-col font-bold text-navy-900">
									<h3 class="text-xl font-bold text-[#0a192f] mb-2 leading-tight font-serif italic">{cake.title}</h3>
									<p class="text-slate-500 text-[10px] uppercase tracking-[0.2em] font-bold mb-6">{cake.porce}</p>
									<div class="mt-auto flex justify-between items-center pt-6 border-t border-slate-50">
										<span class="text-[#92782a] font-black text-2xl">{cake.cena}</span>
										<button 
											data-cake-name={cake.title}
											data-cake-price={cake.cena}
											data-cake-img={cake.foto}
											onclick="window.dispatchEvent(new CustomEvent('add-to-cart', { detail: { name: this.getAttribute('data-cake-name'), price: this.getAttribute('data-cake-price'), img: this.getAttribute('data-cake-img'), quantity: 1 } }))"
											class="bg-[#0a192f] text-white w-12 h-12 rounded-2xl hover:bg-[#d4af37] transition-all duration-300 flex items-center justify-center shadow-lg active:scale-90"
											title="P≈ôidat do objedn√°vky"
										>
											<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
												<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M12 4v16m8-8H4" />
											</svg>
										</button>
									</div>
								</div>
							</div>
						);
					})}
				</div>
			) : (
				<div class="bg-white rounded-[3rem] p-20 text-center border-2 border-dashed border-slate-200 shadow-sm">
					<div class="text-6xl mb-6 opacity-20">üéÇ</div>
					<h3 class="text-2xl font-serif text-slate-500 italic font-bold">V t√©to kategorii zat√≠m nic nen√≠</h3>
					<p class="text-slate-500 mt-2 font-bold">Pracujeme na tom, abyste si brzy mohli vybrat!</p>
					<a href="/dorty" class="inline-block mt-8 text-[#d4af37] font-bold uppercase text-xs tracking-widest border-b border-[#d4af37] pb-1">Zpƒõt na v≈°echny dorty</a>
				</div>
			)}
		</div>
	</main>

	<footer class="bg-[#0a192f] py-16 text-center text-white/50 text-[10px] border-t border-[#d4af37]/10 font-bold font-serif uppercase tracking-widest">
		<div class="max-w-7xl mx-auto px-4">
			<p class="mb-2 italic text-[#d4af37] text-sm normal-case">Cukr√°≈ôstv√≠ Blahutovi</p>
			<p>¬© {new Date().getFullYear()} ‚Äî V≈°echna pr√°va vyhrazena</p>
		</div>
	</footer>
</Layout>

<script is:inline>
	function setupMenu() {
		const btn = document.getElementById('menu-toggle');
		const nav = document.getElementById('nav-menu');
		if (btn && nav) {
			btn.onclick = (e) => {
				e.preventDefault();
				nav.classList.toggle('hidden');
				nav.classList.toggle('flex');
				nav.classList.toggle('flex-col');
				nav.classList.toggle('absolute');
				nav.classList.toggle('top-20');
				nav.classList.toggle('left-0');
				nav.classList.toggle('w-full');
				nav.classList.toggle('bg-[#0a192f]');
				nav.classList.toggle('p-6');
				nav.classList.toggle('z-50');
				nav.classList.toggle('border-b');
				nav.classList.toggle('border-[#d4af37]');
			};
		}
	}
	setupMenu();
	document.addEventListener('astro:page-load', setupMenu);
</script>
