---
import Layout from '../layouts/Layout.astro';
import productsData from '../data.json';
import ReservationForm from '../components/ReservationForm.tsx';
import { Image } from 'astro:assets';

const cakeImages = import.meta.glob<{ default: ImageMetadata }>('/public/img/dorty/*.{jpeg,jpg,png,webp,JPG,JPEG}', { eager: true });

function getImage(path: string, images: Record<string, any>) {
	if (!path) return null;
	const normalizedPath = path.startsWith('/public') ? path : (path.startsWith('/') ? `/public${path}` : `/public/${path}`);
	return images[normalizedPath]?.default || null;
}

const cakeCategories = [
	{ id: 'detske', name: 'Dětské', img: '/img/dorty/32.webp', seo: 'narozeninový dort pro děti Ostrava' },
	{ id: 'narozeninove', name: 'Narozeninové', img: '/img/dorty/49.webp', seo: 'narozeninový dort na zakázku Karviná' },
	{ id: 'svatebni', name: 'Svatební', img: '/img/dorty/51.webp', seo: 'luxusní svatební dort Petřvald' },
	{ id: 'krtiny', name: 'Ke křtinám', img: '/img/dorty/58.webp', seo: 'dort ke křtinám a oslavě narození' },
	{ id: 'elegantni', name: 'Elegantní', img: '/img/dorty/54.webp', seo: 'elegantní dort pro slavnostní příležitosti' },
	{ id: 'nahe', name: 'Nahé', img: '/img/dorty/40.webp', seo: 'ovocný nahý dort s mascarpone' },
	{ id: '3d-netradicni', name: '3D / Ostatní', img: '/img/dorty/12.webp', seo: 'atypický 3D dort na přání' }
];
---

<Layout 
	title="Nabídka dortů na zakázku | Cukrářství Blahutovi" 
	description="Prohlédněte si naše kategorie dortů. Pečeme dětské, svatební i atypické 3D dorty z poctivých surovin v Ostravě, Karviné a Petřvaldě."
>
	<header class="bg-[#0a192f] text-white sticky top-0 z-50 border-b-2 border-[#d4af37]">
		<div class="max-w-7xl mx-auto px-4 h-20 flex justify-between items-center relative font-bold text-navy-900">
			<a href="/" class="group no-underline">
				<span class="text-xl md:text-2xl font-serif text-[#d4af37] group-hover:text-white transition-colors font-bold">Cukrářství Blahutovi</span>
			</a>

			<nav id="nav-menu" class="hidden lg:flex gap-6 uppercase text-[10px] font-bold tracking-widest text-white/90">
				<a href="/dorty" class="text-[#d4af37] py-2 font-bold underline underline-offset-8">Dorty</a>
				<a href="/zakusky" class="hover:text-[#d4af37] py-2">Zákusky</a>
				<a href="/jedly-tisk" class="hover:text-[#d4af37] py-2">Jedlý tisk</a>
				<a href="/dort-na-prani" class="hover:text-[#d4af37] py-2">Dort na přání</a>
				<a href="/prodejny" class="hover:text-[#d4af37] py-2">Prodejny</a>
				<a href="/pro-firmy" class="hover:text-[#d4af37] py-2">Pro firmy</a>
			</nav>

			<div class="flex items-center gap-4">
				<ReservationForm client:load />
				<button id="menu-toggle" aria-label="Otevřít hlavní menu" class="lg:hidden text-[#d4af37] p-2 outline-none cursor-pointer">
					<svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
					</svg>
				</button>
			</div>
		</div>
	</header>

	<main class="py-16 bg-slate-50 min-h-screen">
		<section class="max-w-7xl mx-auto px-4">
			<div class="text-center mb-16">
				<h2 class="text-4xl md:text-5xl font-serif mb-6 italic text-navy-900 font-bold">Naše Dorty</h2>
				<p class="text-slate-600 max-w-2xl mx-auto text-lg font-bold"> Hledáte dokonalý dort pro vaši oslavu? Vyberte si z našich oblíbených kategorií. 
					Každý kus je ruční práce z poctivých surovin.
				</p>
			</div>

			<div class="grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-7 gap-8 font-bold text-navy-900">
				{cakeCategories.map((cat) => {
					const imageSrc = getImage(cat.img, cakeImages);
					return (
						<a href={`/dorty/${cat.id}`} class="group flex flex-col items-center gap-4 no-underline text-navy-900 font-bold">
							<div class="w-full aspect-square rounded-full overflow-hidden border-2 border-slate-100 group-hover:border-[#d4af37] transition-all duration-500 shadow-md relative">
								{imageSrc ? (
									<Image 
										src={imageSrc} 
										alt={`${cat.name} - ${cat.seo}`} 
										class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-700 font-bold" 
										width={180} 
										height={180} 
										format="webp"
										/* OPRAVA LCP: Načítáme ihned a s vysokou prioritou, protože je to nahoře */
										loading="eager"
										fetchpriority="high"
									/>
								) : (
									/* OPRAVA: text-slate-600 pro lepší kontrast (skóre Přístupnost) */
									<div class="w-full h-full bg-slate-100 flex items-center justify-center text-[10px] text-slate-600 font-bold italic">Foto připravujeme</div>
								)}
								<div class="absolute inset-0 bg-black/5 group-hover:bg-transparent transition-colors font-bold"></div>
							</div>
							<span class="text-[11px] font-bold uppercase tracking-[0.15em] text-slate-500 group-hover:text-[#92782a] text-center transition-colors leading-tight font-bold font-serif italic">{cat.name}</span>
						</a>
					)
				})}
			</div>
		</section>
	</main>

	<footer class="bg-[#0a192f] py-16 text-center text-white/40 text-[10px] border-t border-[#d4af37]/10 font-bold font-serif uppercase tracking-widest">
		<div class="max-w-7xl mx-auto px-4 font-bold">
			<p class="mb-2 italic text-[#d4af37] text-sm font-serif font-bold normal-case font-bold">Cukrářství Blahutovi</p>
			<p>© {new Date().getFullYear()} — Všechna práva vyhrazena</p>
		</div>
	</footer>
</Layout>

<script is:inline>
	function setupMenu() {
		const btn = document.getElementById('menu-toggle');
		const nav = document.getElementById('nav-menu');
		if (btn && nav) {
			btn.onclick = (e) => {
				e.preventDefault();
				nav.classList.toggle('hidden');
				nav.classList.toggle('flex');
				nav.classList.toggle('flex-col');
				nav.classList.toggle('absolute');
				nav.classList.toggle('top-20');
				nav.classList.toggle('left-0');
				nav.classList.toggle('w-full');
				nav.classList.toggle('bg-[#0a192f]');
				nav.classList.toggle('p-6');
				nav.classList.toggle('z-50');
				nav.classList.toggle('border-b');
				nav.classList.toggle('border-[#d4af37]');
			};
		}
	}
	setupMenu();
	document.addEventListener('astro:page-load', setupMenu);
</script>
