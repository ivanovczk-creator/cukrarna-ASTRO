---
import Layout from '../layouts/Layout.astro';
import productsData from '../../data.json';
import ReservationForm from '../components/ReservationForm.tsx';
import { Image } from 'astro:assets';

const cakeImages = import.meta.glob<{ default: ImageMetadata }>('/public/img/dorty/*.{jpeg,jpg,png,webp,JPG,JPEG}', { eager: true });
const dessertImages = import.meta.glob<{ default: ImageMetadata }>('/public/img/zakusky/*.{jpeg,jpg,png,webp,JPG,JPEG}', { eager: true });

const desserts = (productsData?.desserts || []).sort((a, b) => (a.weight ?? 999) - (b.weight ?? 999));

function getImage(path: string, images: Record<string, any>) {
	if (!path) return null;
	const normalizedPath = path.startsWith('/public') ? path : (path.startsWith('/') ? `/public${path}` : `/public/${path}`);
	return images[normalizedPath]?.default || null;
}

const cakeCategories = [
	{ id: 'detske', name: 'Dětské', img: '/img/dorty/32.webp' },
	{ id: 'narozeninove', name: 'Narozeninové', img: '/img/dorty/49.webp' },
	{ id: 'svatebni', name: 'Svatební', img: '/img/dorty/51.webp' },
	{ id: 'krtiny', name: 'Ke křtinám', img: '/img/dorty/58.webp' },
	{ id: 'elegantni', name: 'Elegantní', img: '/img/dorty/54.webp' },
	{ id: 'nahe', name: 'Nahé', img: '/img/dorty/40.webp' },
	{ id: '3d-netradicni', name: '3D / Ostatní', img: '/img/dorty/12.webp' }
];
---

<Layout title="Cukrářství Blahutovi | Domácí dorty a zákusky Ostrava a okolí">
	<header class="bg-[#0a192f] text-white sticky top-0 z-50 border-b-2 border-[#d4af37]">
		<div class="max-w-7xl mx-auto px-4 h-20 flex justify-between items-center relative text-navy-900">
			<h1 class="text-xl md:text-2xl font-serif text-[#d4af37]">Cukrářství Blahutovi</h1>
			<nav id="nav-menu" class="hidden lg:flex gap-6 uppercase text-[10px] font-bold tracking-widest text-white/90">
				<a href="#dorty" class="hover:text-[#d4af37] py-2">Dorty</a>
				<a href="#zakusky" class="hover:text-[#d4af37] py-2">Zákusky</a>
				<a href="/jedly-tisk" class="hover:text-[#d4af37] py-2">Jedlý tisk</a>
				<a href="/dort-na-prani" class="hover:text-[#d4af37] py-2 font-bold">Dort na přání</a>
				<a href="/prodejny" class="hover:text-[#d4af37] py-2 font-bold">Prodejny</a>
				<a href="/pro-firmy" class="hover:text-[#d4af37] py-2">Pro firmy</a>
			</nav>
			<div class="flex items-center gap-4">
				<ReservationForm client:load />
				<button id="menu-toggle" class="lg:hidden text-[#d4af37] p-2 cursor-pointer outline-none">
					<svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
					</svg>
				</button>
			</div>
		</div>
	</header>

	<main>
		<section id="dorty" class="py-20 px-4 max-w-7xl mx-auto text-[#0a192f]">
			<h2 class="text-4xl md:text-5xl font-serif text-center mb-4 italic text-navy-900">Naše Dorty</h2>
			<p class="text-center text-slate-500 mb-16 max-w-xl mx-auto text-lg leading-relaxed font-bold font-serif">Vyberte si kategorii dortu pro vaši příležitost:</p>

			<div class="grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-7 gap-8 px-4 font-bold text-navy-900">
				{cakeCategories.map(cat => {
					const imageSrc = getImage(cat.img, cakeImages);
					return (
						<a href={`/dorty/${cat.id}`} class="group flex flex-col items-center gap-4 no-underline text-navy-900 font-bold">
							<div class="w-full aspect-square rounded-full overflow-hidden border-2 border-slate-100 group-hover:border-[#d4af37] transition-all duration-500 shadow-md relative">
								{imageSrc ? (
									<Image src={imageSrc} alt={cat.name} class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-700 font-bold" width={180} height={180} format="webp" />
								) : (
									<div class="w-full h-full bg-slate-50 flex items-center justify-center text-[8px] text-slate-300 italic">Foto</div>
								)}
								<div class="absolute inset-0 bg-black/5 group-hover:bg-transparent transition-colors font-bold"></div>
							</div>
							<span class="text-[11px] font-bold uppercase tracking-[0.15em] text-slate-500 group-hover:text-[#92782a] text-center transition-colors leading-tight font-bold">{cat.name}</span>
						</a>
					)
				})}
			</div>
		</section>

		<section id="zakusky" class="py-20 px-4 bg-slate-50 text-[#0a192f]">
			<div class="max-w-7xl mx-auto font-bold text-navy-900">
				<h2 class="text-4xl md:text-5xl font-serif text-center mb-6 italic font-bold">Denní nabídka čerstvých zákusků</h2>
				<p class="text-center text-slate-500 mb-12 max-w-3xl mx-auto text-lg leading-relaxed font-bold">
					Zákusky pro vás připravujeme každý den čerstvé. Navštivte naše prodejny v Petřvaldě, Karviné či Ostravě a vyberte si přímo ve vitríně.
				</p>
				<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8">
					{desserts.slice(0, 8).map(dessert => { // Zobrazujeme jen prvních 8 jako ochutnávku
						const fotoUrl = dessert.foto || "";
						const imageSrc = getImage(fotoUrl, dessertImages);
						return (
						<div class="bg-white rounded-[2rem] shadow-lg border border-slate-100 overflow-hidden flex flex-col transition-transform hover:-translate-y-1 font-bold">
							<div class="h-56 overflow-hidden relative bg-slate-50 text-center font-bold">
								{imageSrc ? (
									<Image src={imageSrc} alt={dessert.title} class="w-full h-full object-cover transition-transform duration-700 hover:scale-110" width={300} height={300} format="webp" />
								) : (
									<div class="flex items-center justify-center h-full text-xs text-slate-400 italic">Foto připravujeme</div>
								)}
							</div>
							<div class="p-6 flex-grow flex flex-col justify-between font-bold">
								<h3 class="text-lg font-bold mb-1 leading-tight font-bold">{dessert.title}</h3>
								<p class="text-[#92782a] font-black text-xl font-bold">{dessert.cena}</p>
							</div>
						</div>
					)})}
				</div>
			</div>
		</section>

		<section class="py-24 px-4 bg-white font-bold">
			<div class="max-w-5xl mx-auto text-center font-bold">
				<h2 class="text-4xl md:text-5xl font-serif mb-8 italic text-[#0a192f] font-bold">Jedlý tisk na dort</h2>
				<p class="text-lg text-slate-600 mb-10 leading-relaxed font-bold">
					Chcete na dort vlastní fotografii, obrázek nebo logo? Tiskneme na kvalitní jedlý papír i fondánové listy. Objednejte si tisk online a vyzvedněte si ho na našich prodejnách.
				</p>
				<a href="/jedly-tisk" class="inline-block bg-[#0a192f] text-[#d4af37] px-12 py-5 rounded-full font-bold uppercase tracking-widest text-xs hover:bg-[#d4af37] hover:text-[#0a192f] transition-all shadow-xl font-bold">
					Jak objednat jedlý tisk
				</a>
			</div>
		</section>
		
		<section class="py-24 px-4 bg-slate-50 overflow-hidden font-bold">
			<div class="max-w-5xl mx-auto text-center font-bold">
				<h2 class="text-4xl md:text-5xl font-serif mb-8 italic text-[#0a192f] font-bold">Dort přesně podle vašich představ</h2>
				<p class="text-lg text-slate-600 mb-10 leading-relaxed font-bold">
					Máte vlastní předlohu nebo nápad na originální dort? Naše cukrářky pro vás vytvoří sladké umělecké dílo. Podívejte se, jak probíhá zakázková výroba a pošlete nám svou poptávku.
				</p>
				<a href="/dort-na-prani" class="inline-block bg-[#0a192f] text-white px-12 py-5 rounded-full font-bold uppercase tracking-widest text-xs hover:bg-[#d4af37] transition-all shadow-xl font-bold font-serif italic font-bold">
					Chci dort na zakázku
				</a>
			</div>
		</section>

		<section class="py-24 px-4 bg-[#0a192f] text-white font-bold">
			<div class="max-w-5xl mx-auto text-center font-bold">
				<h2 class="text-4xl md:text-5xl font-serif mb-8 italic text-[#d4af37] font-bold font-serif">Navštivte nás</h2>
				<p class="text-lg opacity-90 mb-12 font-bold font-serif">
					Najdete nás v **Petřvaldě, Karviné a Ostravě**. Podívejte se na otevírací dobu, přesné adresy a mapy našich prodejen.
				</p>
				<a href="/prodejny" class="inline-block border-2 border-[#d4af37] text-[#d4af37] px-12 py-5 rounded-full font-bold uppercase tracking-widest text-xs hover:bg-[#d4af37] hover:text-[#0a192f] transition-all font-bold font-serif italic">
					Zobrazit otevírací doby a mapy
				</a>
			</div>
		</section>

		<section class="py-24 px-4 bg-white text-[#0a192f] font-bold font-serif">
			<div class="max-w-4xl mx-auto text-center font-bold">
				<h2 class="text-4xl md:text-5xl font-serif mb-8 italic text-navy-900 font-bold font-serif">Pro firmy a B2B spolupráci</h2>
				<p class="text-lg text-slate-600 leading-relaxed mb-12 font-bold">
					Hledáte spolehlivého dodavatele čerstvých zákusků pro vaši kavárnu nebo restauraci? Nabízíme pravidelný závoz a individuální podmínky.
				</p>
				<a href="/pro-firmy" class="inline-block bg-[#0a192f] text-[#d4af37] px-12 py-5 rounded-full font-bold uppercase tracking-widest text-xs hover:bg-[#d4af37] hover:text-[#0a192f] transition-all shadow-xl font-bold font-serif">
					Více o spolupráci
				</a>
			</div>
		</section>
	</main>

	<footer class="bg-[#0a192f] py-16 text-center text-white/40 text-xs border-t border-[#d4af37]/10 font-bold font-serif">
		<div class="max-w-7xl mx-auto px-4 font-bold text-navy-900 font-serif">
			<p class="mb-4 italic text-[#d4af37] text-lg font-serif font-bold font-serif font-bold">Cukrářství Blahutovi</p>
			<p class="max-w-md mx-auto mb-8 opacity-60 leading-relaxed font-bold font-serif font-bold font-serif">Tradiční rodinné cukrářství. Pečeme pro vás s láskou a z poctivých surovin již od roku 1991. font-bold font-serif font-bold</p>
			<div class="w-20 h-px bg-[#d4af37]/30 mx-auto mb-8 font-bold font-serif"></div>
			<p>© {new Date().getFullYear()} — Všechna práva vyhrazena font-bold font-serif</p>
		</div>
	</footer>
</Layout>

<script is:inline>
	function init() {
		const btn = document.getElementById('menu-toggle');
		const nav = document.getElementById('nav-menu');
		if (btn && nav) {
			btn.onclick = (e) => {
				e.preventDefault();
				const isHidden = nav.classList.contains('hidden');
				if (isHidden) {
					nav.classList.remove('hidden');
					nav.classList.add('flex', 'flex-col', 'absolute', 'top-20', 'left-0', 'w-full', 'bg-[#0a192f]', 'p-6', 'z-50', 'border-b', 'border-[#d4af37]');
				} else {
					nav.classList.add('hidden');
					nav.classList.remove('flex', 'flex-col', 'absolute', 'top-20', 'left-0', 'w-full', 'bg-[#0a192f]', 'p-6', 'z-50', 'border-b', 'border-[#d4af37]');
				}
			};
		}
	}
	init();
	document.addEventListener('astro:after-swap', init);
</script>
