---
import Layout from '../layouts/Layout.astro';
import ReservationForm from '../components/ReservationForm';

// Ověřené cesty z minulého úspěšného propojení
import productsData from '../../data.json';
import b2bData from '../../b2b.json';

// Ochrana pro případ, že JSON má jinou strukturu
const dortyRaw = productsData.dorty || productsData || [];
const zakuskyRaw = productsData.zakusky || [];

const sortedCakes = Array.isArray(dortyRaw) ? [...dortyRaw].sort((a, b) => (a.weight || 100) - (b.weight || 100)) : [];
const sortedDesserts = Array.isArray(zakuskyRaw) ? [...zakuskyRaw].sort((a, b) => (a.weight || 100) - (b.weight || 100)) : [];
const b2b = b2bData;

const stores = [
	{
		name: 'Píšť',
		address: 'Hlavní 123, 739 51 Píšť',
		mapsUrl: 'https://maps.google.com',
		closedDays: ['Sobota', 'Neděle'],
	},
	{
		name: 'Karviná',
		address: 'Náměstí 456, 733 01 Karviná',
		mapsUrl: 'https://maps.google.com',
		closedDays: ['Neděle'],
	},
	{
		name: 'Ostrava',
		address: 'Hlavní třída 789, 702 00 Ostrava',
		mapsUrl: 'https://maps.google.com',
		closedDays: ['Neděle'],
	},
	{
		name: 'Petřvald',
		address: 'Nádražní 321, 735 41 Petřvald',
		mapsUrl: 'https://maps.google.com',
		closedDays: ['Pondělí'],
	},
];
---

<Layout>
	<div class="min-h-screen">
		<header class="bg-white shadow-md sticky top-0 z-50">
			<nav class="container mx-auto px-4 py-4">
				<div class="flex items-center justify-between">
					<h1 class="text-3xl font-bold text-navy-900">Cukrářství Blahutovi</h1>
					<div class="hidden md:flex gap-6 items-center">
						<a href="#dorty" class="text-gray-700 hover:text-gold-500 transition-colors">Dorty</a>
						<a href="#zakusky" class="text-gray-700 hover:text-gold-500 transition-colors">Zákusky</a>
						<a href="#prodejny" class="text-gray-700 hover:text-gold-500 transition-colors">Prodejny</a>
						<a href="#b2b" class="text-gray-700 hover:text-gold-500 transition-colors">B2B</a>
						<a href="#rezervace" class="bg-gold-500 text-navy-900 px-6 py-2 rounded-full font-semibold hover:bg-gold-400 transition-colors shadow-md">Rezervace</a>
					</div>
				</div>
			</nav>
		</header>

		<section class="relative bg-gradient-to-br from-navy-900 to-navy-800 text-white py-32 px-4">
			<div class="container mx-auto text-center">
				<h2 class="text-5xl md:text-6xl font-bold mb-6">Vítejte v Cukrářství Blahutovi</h2>
				<p class="text-xl md:text-2xl mb-8 max-w-2xl mx-auto font-light">
					Rodinné cukrářství s tradicí od roku 1985. Nabízíme čerstvé dorty, zákusky a další sladkosti připravené s láskou.
				</p>
				<a href="#dorty" class="inline-block bg-gold-500 text-navy-900 px-8 py-3 rounded-full font-semibold hover:bg-gold-400 transition-colors shadow-lg">
					Prohlédnout nabídku
				</a>
			</div>
			<div class="absolute bottom-0 left-0 right-0 h-16 bg-gradient-to-t from-offwhite to-transparent"></div>
		</section>

		{sortedCakes.length > 0 && (
		<section id="dorty" class="py-20 px-4">
			<div class="container mx-auto">
				<h2 class="text-4xl md:text-5xl font-bold text-center mb-12 text-gray-800">Naše dorty</h2>
				<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
					{sortedCakes.map((product) => (
						<div class="bg-white rounded-2xl shadow-lg overflow-hidden border border-gold-500/20">
							<div class="aspect-square bg-gradient-to-br from-cream to-offwhite flex items-center justify-center">
								<a href={product.image} class="glightbox w-full h-full">
									<img src={product.image} alt={product.title} class="w-full h-full object-cover" loading="lazy" />
								</a>
							</div>
							<div class="p-6">
								<h3 class="text-xl font-bold mb-2 text-navy-900">{product.title}</h3>
								<p class="text-gray-600 mb-3">{product.description}</p>
								<p class="text-gold-600 font-semibold text-lg mb-4">{product.price}</p>
								<button class="order-button w-full bg-gold-500 text-navy-900 py-2 rounded-lg font-semibold hover:bg-gold-400 transition-colors">Objednat</button>
							</div>
						</div>
					))}
				</div>
			</div>
		</section>
		)}

		{sortedDesserts.length > 0 && (
		<section id="zakusky" class="py-20 px-4 bg-white">
			<div class="container mx-auto">
				<h2 class="text-4xl md:text-5xl font-bold text-center mb-12 text-gray-800">Naše zákusky</h2>
				<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
					{sortedDesserts.map((product) => (
						<div class="bg-white rounded-2xl shadow-lg overflow-hidden border border-gold-500/20">
							<div class="aspect-square bg-gradient-to-br from-cream to-offwhite flex items-center justify-center">
								<a href={product.image} class="glightbox w-full h-full">
									<img src={product.image} alt={product.title} class="w-full h-full object-cover" loading="lazy" />
								</a>
							</div>
							<div class="p-6">
								<h3 class="text-xl font-bold mb-2 text-navy-900">{product.title}</h3>
								<p class="text-gray-600 mb-3">{product.description}</p>
								<p class="text-gold-600 font-semibold text-lg mb-4">{product.price}</p>
								<button class="order-button w-full bg-gold-500 text-navy-900 py-2 rounded-lg font-semibold hover:bg-gold-400 transition-colors">Objednat</button>
							</div>
						</div>
					))}
				</div>
			</div>
		</section>
		)}

		<section id="prodejny" class="py-20 px-4">
			<div class="container mx-auto text-center">
				<h2 class="text-4xl md:text-5xl font-bold mb-12 text-gray-800">Naše prodejny</h2>
				<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 text-left">
					{stores.map((store) => (
						<div class="bg-cream rounded-2xl p-6 shadow-lg border border-gold-500/20">
							<h3 class="text-2xl font-bold mb-3 text-gold-600">{store.name}</h3>
							<p class="text-gray-700 mb-4">{store.address}</p>
							<div class="mb-4">
								<p class="text-sm text-gray-600 font-semibold mb-1">Zavřeno:</p>
								<p class="text-sm text-gray-600">{store.closedDays.join(', ')}</p>
							</div>
							<a href={store.mapsUrl} target="_blank" rel="noopener noreferrer" class="inline-block w-full text-center bg-navy-900 text-white px-6 py-2 rounded-lg hover:bg-navy-800 transition-colors">
								Zobrazit na mapě
							</a>
						</div>
					))}
				</div>
			</div>
		</section>

		<section id="b2b" class="py-20 px-4 bg-gradient-to-br from-navy-900 to-navy-800 text-white text-center">
			<div class="container mx-auto">
				<h2 class="text-4xl md:text-5xl font-bold mb-4">{b2b.title || 'B2B Spolupráce'}</h2>
				<p class="text-xl text-gray-300 mb-12 max-w-3xl mx-auto">{b2b.description || 'Nabízíme velkoobchodní odběr našich výrobků.'}</p>
				<a href="#rezervace" class="inline-block bg-gold-500 text-navy-900 px-10 py-4 rounded-full font-bold text-lg hover:bg-gold-400 transition-colors shadow-xl">
					Chci spolupracovat
				</a>
			</div>
		</section>

		<section id="rezervace" class="py-20 px-4 bg-gradient-to-br from-cream to-offwhite">
			<div class="container mx-auto max-w-2xl">
				<h2 class="text-4xl md:text-5xl font-bold text-center mb-12 text-gray-800">Rezervace</h2>
				<div class="bg-white rounded-2xl shadow-xl p-8">
					<ReservationForm client:load stores={stores} />
				</div>
			</div>
		</section>

		<footer class="bg-navy-900 text-white py-12 px-4 text-center">
			<h3 class="text-2xl font-bold mb-4 text-gold-500">Cukrářství Blahutovi</h3>
			<p class="text-gray-300">© 2026 Cukrářství Blahutovi. Všechna práva vyhrazena.</p>
		</footer>
	</div>
</Layout>

<script>
	function init() {
		const orderButtons = document.querySelectorAll('.order-button');
		orderButtons.forEach(button => {
			button.addEventListener('click', () => {
				document.getElementById('rezervace')?.scrollIntoView({ behavior: 'smooth' });
			});
		});
	}
	init();
	document.addEventListener('astro:after-swap', init);
</script>
